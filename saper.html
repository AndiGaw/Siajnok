<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Skoczek pustynny ‚Äì Arrakis</title>
<style>
html, body {
    margin:0; padding:0; height:100%;
    background:#000; color:#e6c47a;
    font-family:"Georgia",serif;
}
.container {
    display:flex;
    justify-content:center;
    align-items:flex-start;
    gap:20px;
    width:100%; max-width:1200px;
    margin:20px auto 0;
}

/* LƒÖdowisko A ‚Äì po lewej, statyczne */
#helipad {
    width:220px; /* 4 kratki x 50 + 3*2px border? */
    height:220px;
    background:#444;
    border:2px solid #e6c47a;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#e6c47a;
    font-weight:bold;
    font-size:1.5em;
    border-radius:8px;
    flex-shrink:0;
}

/* Plansza gry */
#board {
    display:inline-grid;
    gap:3px;
    grid-template-columns: repeat(10, 50px);
}

/* Kom√≥rki planszy */
.cell {
    width:50px; height:50px;
    background:#222;
    border:2px solid #e6c47a;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    font-weight:bold;
    font-size:1.2em;
}
.visited {background:#444;}
.start {background:darkgreen; color:#fff; font-weight:bold;}
.goal {background:darkblue; color:#fff; font-weight:bold;}
.worm {background:darkred; color:white;}

/* LƒÖdowisko B ‚Äì po prawej, pojawia siƒô dopiero po wygranej */
#helipad-end {
    width:220px; height:220px;
    background:#444;
    border:2px solid #e6c47a;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#e6c47a;
    font-weight:bold;
    font-size:1.5em;
    border-radius:8px;
    flex-shrink:0;
    display:none; /* ukryte na start */
}

#controls {
    width:100%;
    text-align:center;
    margin-bottom:10px;
}
#controls button {
    font-size:1.3em; padding:12px 24px; background:#111; color:#e6c47a;
    border:2px solid #e6c47a; border-radius:8px; cursor:pointer;
    box-shadow:0 0 10px rgba(230,196,122,0.5);
    transition:all 0.2s;
}
#controls button:hover {background:#222; box-shadow:0 0 20px rgba(230,196,122,0.8);}
#controls label {font-size:1em; cursor:pointer; color:#e6c47a;}

#stats {margin-top:10px; font-size:1.1em; font-weight:bold;}
#top10 {margin-top:20px; text-align:center; font-size:1em;}

.popup {position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#111; color:#e6c47a; border:3px solid #e6c47a; padding:20px;
    z-index:5; display:none; text-align:center; width:300px; border-radius:12px;
    box-shadow:0 0 20px rgba(230,196,122,0.6);
}
.popup h2 {margin-top:0; font-size:1.5em;}
.popup button {margin-top:10px; padding:5px 10px; cursor:pointer;}
</style>
</head>
<body>
<div id="controls">
    <button onclick="playNarrator()">üéôÔ∏è Narrator</button>
    <button onclick="startGame()">üèúÔ∏è Wyrusz w drogƒô przez piaski</button>
    <label><input type="checkbox" id="hardMode"> Hard Mode ‚Äì ruchome czerwie</label>
    <div id="stats">Kroki: 0 | Punktacja: 0</div>
</div>

<div class="container">
    <div id="helipad">A</div>
    <div id="board"></div>
    <div id="helipad-end">B</div>
</div>

<div id="top10"></div>

<audio id="narrator-audio"><source src="Saper_Diuny.mp3" type="audio/mpeg"></audio>

<div id="popup-fail" class="popup">
    <h2>üíÄ Po≈ºar≈Ç Ciƒô Czerw Pustyni!</h2>
    <p>Kroki: <span id="fail-steps"></span></p>
    <button onclick="closePopup('fail')">Zamknij</button>
</div>
<div id="popup-win" class="popup">
    <h2>üèÜ Dotar≈Çe≈õ do B!</h2>
    <p>Kroki: <span id="win-steps"></span><br> Punktacja: <span id="win-score"></span></p>
    <button onclick="closePopup('win')">Zamknij</button>
</div>

<script>
const size = 10, worms = 12;
let board=[], gameOver=false, playerPos={x:0,y:0}, steps=0, score=0, firstMove=true;
let audioCtx=null, oscillator=null, gainNode=null, lastVibration=0;
let topScores = JSON.parse(localStorage.getItem("topScores")||"[]");

function initSound(){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    oscillator = audioCtx.createOscillator();
    gainNode = audioCtx.createGain();
    oscillator.type="sine";
    oscillator.frequency.setValueAtTime(50,audioCtx.currentTime);
    gainNode.gain.setValueAtTime(0,audioCtx.currentTime);
    oscillator.connect(gainNode); gainNode.connect(audioCtx.destination);
    oscillator.start();
}

function isAdjacent(x,y){
    const dx=Math.abs(playerPos.x-x), dy=Math.abs(playerPos.y-y);
    return dx+dy===1 || (firstMove && playerPos.x===0 && playerPos.y===0 && dx+dy===1);
}

function startGame(){
    const boardDiv=document.getElementById("board");
    boardDiv.innerHTML="";
    board.style=[]; // reset
    board=[];
    gameOver=false; playerPos={x:0,y:0}; steps=0; score=0; firstMove=true;
    document.getElementById("stats").innerText=`Kroki: 0 | Punktacja: 0`;
    document.getElementById("helipad-end").style.display="none";

    if(!audioCtx) initSound();
    if(audioCtx.state==="suspended") audioCtx.resume();

    for(let y=0;y<size;y++){
        board[y]=[];
        for(let x=0;x<size;x++){
            board[y][x]={worm:false,visited:false};
            const cell=document.createElement("div");
            cell.className="cell"; cell.dataset.x=x; cell.dataset.y=y;
            cell.onclick=()=>reveal(x,y);
            boardDiv.appendChild(cell);
        }
    }

    placeWorms(); drawBoard();
}

function placeWorms(){
    let placed=0;
    while(placed<worms){
        let x=Math.floor(Math.random()*size);
        let y=Math.floor(Math.random()*size);
        if((x===0&&y===0)||(x===size-1&&y===size-1)) continue;
        if(!board[y][x].worm){ board[y][x].worm=true; placed++; }
    }
}

function reveal(x,y){
    if(gameOver) return;
    if(!isAdjacent(x,y)) return;
    const cell=board[y][x]; const div=getCell(x,y);
    if(!cell.visited) steps++;
    playerPos={x,y}; cell.visited=true;
    div.classList.add("visited"); updateStats(); firstMove=false;

    if(cell.worm){
        div.classList.add("worm"); div.textContent="ü™±"; gameOver=true;
        revealAllWorms(); stopSound();
        navigator.vibrate([300,100,300,100,600]);
        document.getElementById("fail-steps").innerText=steps;
        document.getElementById("popup-fail").style.display="block";
        return;
    }

    if(x===size-1 && y===size-1){
        gameOver=true; score=Math.max(0,100-steps*2);
        if(document.getElementById("hardMode").checked) score*=3;
        stopSound(); document.getElementById("win-steps").innerText=steps;
        document.getElementById("win-score").innerText=score;
        document.getElementById("popup-win").style.display="block";
        revealAllWorms(); updateTop10();
        document.getElementById("helipad-end").style.display="flex";
    }

    drawBoard();
}

function drawBoard(){
    for(let y=0;y<size;y++) for(let x=0;x<size;x++){
        const div=getCell(x,y); div.className="cell"; div.textContent="";
        if(board[y][x].visited) div.classList.add("visited");
        if(x===0&&y===0){ div.classList.add("start"); div.textContent="A"; }
        if(x===size-1&&y===size-1){ div.classList.add("goal"); div.textContent="B"; }
        if(playerPos.x===x && playerPos.y===y) div.textContent="üë£";
    }
}

function getCell(x,y){ return document.querySelector(`#board .cell[data-x='${x}'][data-y='${y}']`); }
function revealAllWorms(){ for(let y=0;y<size;y++) for(let x=0;x<size;x++) if(board[y][x].worm){ const div=getCell(x,y); div.classList.add("worm"); div.textContent="ü™±"; } }
function updateStats(){ document.getElementById("stats").innerText=`Kroki: ${steps} | Punktacja: ${score}`; }
function closePopup(type){ document.getElementById(`popup-${type}`).style.display="none"; }
function updateTop10(){
    let name=prompt("Wpisz sw√≥j nick:")||"Anonim";
    topScores.push({name,score});
    topScores.sort((a,b)=>b.score-a.score);
    if(topScores.length>10) topScores=topScores.slice(0,10);
    localStorage.setItem("topScores",JSON.stringify(topScores));
    const topDiv=document.getElementById("top10"); topDiv.innerHTML="<h3>TOP 10</h3>";
    topScores.forEach((s,i)=> topDiv.innerHTML+=`${i+1}. ${s.name} ‚Äì ${s.score}<br>`);
}
function playNarrator(){ const audio=document.getElementById("narrator-audio"); if(audioCtx&&audioCtx.state==="suspended") audioCtx.resume(); audio.play(); }
function stopSound(){ if(gainNode) gainNode.gain.setTargetAtTime(0,audioCtx.currentTime,0.2); }

document.addEventListener("click",()=>{ if(audioCtx && audioCtx.state==="suspended") audioCtx.resume(); if("vibrate" in navigator) navigator.vibrate(1); });
</script>
</body>
</html>
