<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Przeprawa przez Arrakis â€“ z Echem Czerwia</title>
<title>Przeprawa przez Arrakis â€“ peÅ‚ny klimat</title>

<style>
html, body {
@@ -17,6 +17,18 @@
position:relative;
}

body.shake {
  animation: shake 0.1s infinite;
}

@keyframes shake {
  0% { transform: translate(1px, 1px); }
  25% { transform: translate(-1px, -1px); }
  50% { transform: translate(1px, -1px); }
  75% { transform: translate(-1px, 1px); }
  100% { transform: translate(0,0); }
}

.sand {
position:fixed;
width:100%;
@@ -47,20 +59,21 @@
#board {
display: inline-grid;
margin-top: 20px;
  gap: 2px;
  gap: 3px;
min-height: 50px;
}

.cell {
  width: 32px;
  height: 32px;
  width: 50px;  /* wiÄ™ksze pola */
  height: 50px;
background: #222;
  border: 1px solid #e6c47a;
  border: 2px solid #e6c47a;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-weight: bold;
  font-size: 1.2em;
}

.visited { background: #444; }
@@ -77,7 +90,7 @@
cursor:pointer;
}

#audioInfo {
#audioInfo, #stats {
margin-top:10px;
font-size:0.9em;
}
@@ -94,6 +107,7 @@ <h1>Przeprawa przez Arrakis</h1>
<p>PrzejdÅº z punktu <b>A</b> do <b>B</b> unikajÄ…c Czerwii Pustyni!</p>

<div id="audioInfo">Kliknij gdziekolwiek aby aktywowaÄ‡ sonar ðŸ”Š</div>
  <div id="stats">Kroki: 0 | Punktacja: 0</div>

<label>Rozmiar:
<input id="size" type="number" value="10" min="5" max="20">
@@ -113,6 +127,8 @@ <h1>Przeprawa przez Arrakis</h1>
let board = [];
let gameOver = false;
let playerPos = {x:0, y:0};
let steps = 0;
let score = 0;

/* ---- AUDIO ---- */
let audioCtx = null;
@@ -121,22 +137,17 @@ <h1>Przeprawa przez Arrakis</h1>

function initSound() {
audioCtx = new (window.AudioContext || window.webkitAudioContext)();

oscillator = audioCtx.createOscillator();
gainNode = audioCtx.createGain();

oscillator.type = "sine";
oscillator.frequency.setValueAtTime(50, audioCtx.currentTime);

gainNode.gain.setValueAtTime(0, audioCtx.currentTime);

oscillator.connect(gainNode);
gainNode.connect(audioCtx.destination);

oscillator.start();
}

function updateSound() {
function updateSoundAndShake() {
if (!audioCtx) return;

let minDist = Infinity;
@@ -154,9 +165,15 @@ <h1>Przeprawa przez Arrakis</h1>

let freq = 60 + (size - minDist) * 20;
let volume = Math.max(0, (size - minDist) / size);

oscillator.frequency.setTargetAtTime(freq, audioCtx.currentTime, 0.1);
gainNode.gain.setTargetAtTime(volume * 0.35, audioCtx.currentTime, 0.1);

  // Efekt drÅ¼enia ekranu
  if (minDist <= 3 && !gameOver) {
    document.body.classList.add("shake");
  } else {
    document.body.classList.remove("shake");
  }
}

function stopSound() {
@@ -165,163 +182,129 @@ <h1>Przeprawa przez Arrakis</h1>
}

/* ---- GRA ---- */

function startGame() {

const boardDiv = document.getElementById("board");

size = parseInt(document.getElementById("size").value);
worms = parseInt(document.getElementById("mines").value);

  if (worms >= size * size - 2) {
    alert("Za duÅ¼o czerwii!");
    return;
  }
  if (worms >= size * size - 2) { alert("Za duÅ¼o czerwii!"); return; }

if (!audioCtx) initSound();
if (audioCtx.state === "suspended") audioCtx.resume();

board = [];
gameOver = false;
playerPos = {x:0, y:0};
  steps = 0;
  score = 0;
  document.getElementById("stats").innerText = `Kroki: 0 | Punktacja: 0`;

boardDiv.innerHTML = "";
  boardDiv.style.gridTemplateColumns = `repeat(${size}, 32px)`;

  for (let y = 0; y < size; y++) {
    board[y] = [];

    for (let x = 0; x < size; x++) {
      board[y][x] = {
        worm: false,
        visited: false
      };
  boardDiv.style.gridTemplateColumns = `repeat(${size}, 50px)`;

  for (let y=0;y<size;y++) {
    board[y]=[];
    for (let x=0;x<size;x++) {
      board[y][x]={worm:false, visited:false};
const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.x = x;
      cell.dataset.y = y;

      cell.onclick = () => moveTo(x, y);

      cell.className="cell";
      cell.dataset.x=x;
      cell.dataset.y=y;
      cell.onclick=()=>moveTo(x,y);
boardDiv.appendChild(cell);
}
}

placeWorms();
  updateSound();
  updateSoundAndShake();
drawBoard();
}

function placeWorms() {
  let placed = 0;

  while (placed < worms) {
    let x = Math.floor(Math.random() * size);
    let y = Math.floor(Math.random() * size);

    if ((x === 0 && y === 0) || (x === size-1 && y === size-1))
      continue;

    if (!board[y][x].worm) {
      board[y][x].worm = true;
      placed++;
    }
  let placed=0;
  while(placed<worms) {
    let x=Math.floor(Math.random()*size);
    let y=Math.floor(Math.random()*size);
    if((x===0&&y===0)||(x===size-1&&y===size-1)) continue;
    if(!board[y][x].worm){ board[y][x].worm=true; placed++; }
}
}

function isAdjacent(x, y) {
  const dx = Math.abs(playerPos.x - x);
  const dy = Math.abs(playerPos.y - y);
  return (dx + dy === 1);
function isAdjacent(x,y){
  return Math.abs(playerPos.x - x) + Math.abs(playerPos.y - y) ===1;
}

function moveTo(x, y) {
  if (gameOver) return;
  if (!isAdjacent(x, y)) return;

  playerPos = {x, y};
  board[y][x].visited = true;
function moveTo(x,y){
  if(gameOver) return;
  if(!isAdjacent(x,y)) return;

  updateSound();
  playerPos={x,y};
  if(!board[y][x].visited) steps++;
  board[y][x].visited=true;
  updateSoundAndShake();
  document.getElementById("stats").innerText = `Kroki: ${steps} | Punktacja: ${score}`;

  if (board[y][x].worm) {
  if(board[y][x].worm){
revealWorms();
stopSound();
    document.getElementById("stats").innerText = `Kroki: ${steps} | Punktacja: 0`;
alert("PoÅ¼arÅ‚ CiÄ™ Czerw Pustyni! ðŸ’€");
    gameOver = true;
    gameOver=true;
    document.body.classList.remove("shake");
return;
}

  if (x === size-1 && y === size-1) {
  if(x===size-1 && y===size-1){
stopSound();
    alert("DotarÅ‚eÅ› do celu! ZÅ‚oty Szlak zwyciÄ™Å¼yÅ‚! ðŸŽ‰");
    gameOver = true;
    score = Math.max(0, 100 - steps*2);
drawBoard();
    alert(`DotarÅ‚eÅ› do celu! ZÅ‚oty Szlak zwyciÄ™Å¼yÅ‚! ðŸŽ‰\nPunkty: ${score}`);
    document.getElementById("stats").innerText = `Kroki: ${steps} | Punktacja: ${score}`;
    gameOver=true;
    document.body.classList.remove("shake");
return;
}

drawBoard();
}

function revealWorms() {
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      if (board[y][x].worm) {
        const div = getCell(x, y);
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      if(board[y][x].worm){
        const div=getCell(x,y);
div.classList.add("worm");
        div.textContent = "ðŸª±";
        div.textContent="ðŸª±";
}
}
}
}

function drawBoard() {
  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      const div = getCell(x, y);
      div.className = "cell";
      div.textContent = "";

      if (board[y][x].visited)
        div.classList.add("visited");

      if (x === 0 && y === 0) {
        div.classList.add("start");
        div.textContent = "A";
      }

      if (x === size-1 && y === size-1) {
        div.classList.add("goal");
        div.textContent = "B";
      }

      if (x === playerPos.x && y === playerPos.y) {
        div.textContent = "ðŸ‘£";
      }
function drawBoard(){
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const div=getCell(x,y);
      div.className="cell";
      div.textContent="";
      if(board[y][x].visited) div.classList.add("visited");
      if(x===0 && y===0){ div.classList.add("start"); div.textContent="A"; }
      if(x===size-1 && y===size-1){ div.classList.add("goal"); div.textContent="B"; }
      if(x===playerPos.x && y===playerPos.y) div.textContent="ðŸ‘£";
}
}
}

function getCell(x, y) {
  return document.querySelector(
    `.cell[data-x='${x}'][data-y='${y}']`
  );
function getCell(x,y){
  return document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
}

/* odblokowanie audio po pierwszym klikniÄ™ciu */
document.addEventListener("click", () => {
  if (audioCtx && audioCtx.state === "suspended") {
    audioCtx.resume();
    document.getElementById("audioInfo").innerText =
      "Sonar czerwia aktywny ðŸ”Š";
  }
/* Odblokowanie audio po pierwszym klikniÄ™ciu */
document.addEventListener("click", ()=>{
  if(audioCtx && audioCtx.state==="suspended"){ audioCtx.resume(); document.getElementById("audioInfo").innerText="Sonar czerwia aktywny ðŸ”Š"; }
});

/* NAJWAÅ»NIEJSZA POPRAWKA â€“ start gry dopiero po zaÅ‚adowaniu strony */
window.onload = () => {
  startGame();
};
/* Start gry po zaÅ‚adowaniu strony */
window.onload=()=>{ startGame(); };
</script>

</body>
