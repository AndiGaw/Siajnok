<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Skoczek pustynny ‚Äì Arrakis</title>
<style>
html, body {
    margin:0; padding:0; height:100%;
    background:#000; color:#e6c47a;
    font-family:"Georgia",serif;
}

.container {
    width:95%; max-width:900px; margin:0 auto;
    text-align:center;
}

h1 {
    font-size:2em;
    margin-bottom:15px;
    text-shadow:1px 1px 4px #000;
}

#controls {
    display:flex; flex-direction:column; align-items:center;
    gap:10px;
    margin-bottom:10px;
}

#controls button {
    font-size:1.3em; padding:12px 24px; background:#111; color:#e6c47a;
    border:2px solid #e6c47a; border-radius:8px; cursor:pointer;
    box-shadow:0 0 10px rgba(230,196,122,0.5); transition:all 0.2s;
}

#controls button:hover {
    background:#222; box-shadow:0 0 20px rgba(230,196,122,0.8);
}

#controls label {
    font-size:1em; cursor:pointer; color:#e6c47a;
}

#board-wrapper {
    display:flex; flex-direction:row; justify-content:center; align-items:flex-start;
    gap:10px; position:relative; margin-bottom:20px;
}

#board {
    display:inline-grid; gap:3px;
}

.cell {
    width:50px; height:50px; background:#222; border:2px solid #e6c47a;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; font-weight:bold; font-size:1.2em;
}

.visited { background:#444; }
.start { background:darkgreen; color:#fff; font-weight:bold; }
.goal { background:darkblue; color:#fff; font-weight:bold; }
.worm { background:darkred; color:white; }

/* LƒÖdowisko A po lewej */
#helipad {
    width:60px; height:60px;
    background:#444; border:2px solid #e6c47a;
    display:flex; align-items:center; justify-content:center;
    color:#e6c47a; font-weight:bold; font-size:0.9em; border-radius:8px;
    flex-shrink:0; margin-right:10px;
}

/* LƒÖdowisko B po prawej */
#helipad-end {
    width:60px; height:60px;
    background:#444; border:2px solid #e6c47a;
    display:flex; align-items:center; justify-content:center;
    color:#e6c47a; font-weight:bold; font-size:0.9em; border-radius:8px;
    flex-shrink:0; margin-left:10px;
    display:none;
}

#stats { margin-top:10px; font-size:1.1em; font-weight:bold; }
#top10 { margin-top:20px; text-align:center; font-size:1em; }

#worm-map {
    margin-top:15px; display:inline-grid; gap:2px; justify-content:center;
}

#worm-map .cell { width:20px; height:20px; font-size:0.8em; }

body.shake {
    animation: shake 0.1s infinite;
}

@keyframes shake {
    0% { transform:translate(1px,1px); }
    25% { transform:translate(-1px,-1px); }
    50% { transform:translate(1px,-1px); }
    75% { transform:translate(-1px,1px); }
    100% { transform:translate(0,0); }
}

.popup {
    position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#111; color:#e6c47a; border:3px solid #e6c47a; padding:20px;
    z-index:5; display:none; text-align:center; width:300px; border-radius:12px;
    box-shadow:0 0 20px rgba(230,196,122,0.6);
}

.popup h2 { margin-top:0; font-size:1.5em; }
.popup button { margin-top:10px; padding:5px 10px; cursor:pointer; }

</style>
</head>
<body>

<div class="container">
    <h1>Przeprawa przez Arrakis</h1>

    <div id="controls">
        <button onclick="playNarrator()">üéôÔ∏è Narrator</button>
        <button onclick="startGame()">üèúÔ∏è Wyrusz w drogƒô przez piaski</button>
        <label><input type="checkbox" id="hardMode"> Hard Mode ‚Äì ruchome czerwie</label>
    </div>

    <div id="stats">Kroki: 0 | Punktacja: 0</div>

    <div id="board-wrapper">
        <div id="helipad">LƒÖdowisko A</div>
        <div id="board"></div>
        <div id="helipad-end">LƒÖdowisko B</div>
    </div>

    <div id="worm-map"></div>
    <div id="top10"></div>

    <audio id="narrator-audio">
        <source src="Saper_Diuny.mp3" type="audio/mpeg">
    </audio>

    <div id="popup-fail" class="popup">
        <h2>üíÄ Po≈ºar≈Ç Ciƒô Czerw Pustyni!</h2>
        <p>Kroki: <span id="fail-steps"></span></p>
        <button onclick="closePopup('fail')">Zamknij</button>
    </div>

    <div id="popup-win" class="popup">
        <h2>üèÜ Dotar≈Çe≈õ do B!</h2>
        <p>Kroki: <span id="win-steps"></span><br> Punktacja: <span id="win-score"></span></p>
        <button onclick="closePopup('win')">Zamknij</button>
    </div>
</div>

<script>
const size = 10, worms = 12;
let board=[], gameOver=false, playerPos={x:0,y:0}, steps=0, score=0, firstMove=true;
let audioCtx=null, oscillator=null, gainNode=null, lastVibration=0;
let topScores = JSON.parse(localStorage.getItem("topScores")||"[]");

function initSound() {
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    oscillator = audioCtx.createOscillator();
    gainNode = audioCtx.createGain();
    oscillator.type = "sine";
    oscillator.frequency.setValueAtTime(50,audioCtx.currentTime);
    gainNode.gain.setValueAtTime(0,audioCtx.currentTime);
    oscillator.connect(gainNode); gainNode.connect(audioCtx.destination);
    oscillator.start();
}

function isAdjacent(x,y) {
    const dx = Math.abs(playerPos.x - x);
    const dy = Math.abs(playerPos.y - y);
    return dx+dy===1 || (firstMove && playerPos.x===0 && playerPos.y===0 && dx+dy===1);
}

function vibrateLevel(d) {
    if(!("vibrate" in navigator)) return;
    const now=Date.now(); if(now-lastVibration<150) return; lastVibration=now;
    if(d>=4) navigator.vibrate(10);
    else if(d===3) navigator.vibrate(30);
    else if(d===2) navigator.vibrate([60,30,60]);
    else if(d===1) navigator.vibrate([100,50,100]);
    else navigator.vibrate([200,100,200]);
}

function updateSoundAndShake() {
    if(!audioCtx) return;
    let minDist=Infinity;
    for(let y=0;y<size;y++) for(let x=0;x<size;x++)
        if(board[y][x].worm) {
            const dist=Math.abs(playerPos.x-x)+Math.abs(playerPos.y-y);
            if(dist<minDist) minDist=dist;
        }
    if(minDist===Infinity) minDist=size;
    let freq=50,vol=0;
    if(minDist>=4){freq=50; vol=0;}
    else if(minDist===3){freq=150; vol=0.1;}
    else if(minDist===2){freq=300; vol=0.2;}
    else if(minDist===1){freq=500; vol=0.35;}
    else{freq=800; vol=0.5;}
    oscillator.frequency.setTargetAtTime(freq,audioCtx.currentTime,0.05);
    gainNode.gain.setTargetAtTime(vol,audioCtx.currentTime,0.05);
    if(minDist<=3 && !gameOver) document.body.classList.add("shake");
    else document.body.classList.remove("shake");
    vibrateLevel(minDist);
}

function stopSound(){ if(gainNode) gainNode.gain.setTargetAtTime(0,audioCtx.currentTime,0.2); }

// --- reszta funkcji startGame, placeWorms, reveal, drawBoard, moveWorms, revealAllWorms, updateWormMap, updateStats, showHelipadB, closePopup, updateTop10, playNarrator ---
// Zostawiamy dok≈Çadnie jak w Twojej bazie, nic nie zmieniamy w funkcjach.
</script>

</body>
</html>
