<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Skoczek pustynny â€“ Arrakis</title>

<style>
html, body {
    margin:0; padding:0; height:100%;
    background:#000; color:#e6c47a;
    font-family:"Georgia",serif; text-align:center;
}

.container {
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    min-height:100vh;
}

#board-wrapper {
    display:flex;
    align-items:center;
    justify-content:center;
    gap:20px;
    margin-top:20px;
}

#board {
    display:inline-grid;
    gap:3px;
}

.cell {
    width:50px; height:50px;
    background:#222;
    border:2px solid #e6c47a;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    font-weight:bold;
    font-size:1.2em;
}

.visited { background:#444; }
.start { background:darkgreen; color:white; }
.goal  { background:darkblue;  color:white; }
.worm  { background:darkred;   color:white; }

.helipad {
    width:70px;
    height:70px;
    background:#333;
    border:2px solid #e6c47a;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#e6c47a;
    font-weight:bold;
    border-radius:8px;
}

#helipad-end {
    visibility:hidden;
}
</style>
</head>

<body>

<div class="container">

<h1>Przeprawa przez Arrakis</h1>

<button onclick="startGame()">Nowa Wyprawa</button>

<div id="stats">Kroki: 0</div>

<div id="board-wrapper">
    <div id="helipad-start" class="helipad">A</div>
    <div id="board"></div>
    <div id="helipad-end" class="helipad">B</div>
</div>

</div>

<script>

const size = 10;
const worms = 12;

let board = [];
let playerPos = {x:0, y:0};
let steps = 0;
let gameOver = false;
let firstMove = true;

// Sprawdzenie ruchu sÄ…siedniego
function isAdjacent(x, y) {
    const dx = Math.abs(playerPos.x - x);
    const dy = Math.abs(playerPos.y - y);
    return dx + dy === 1;
}

function startGame() {

    const boardDiv = document.getElementById("board");
    boardDiv.innerHTML = "";
    boardDiv.style.gridTemplateColumns = `repeat(${size}, 50px)`;

    board = [];
    steps = 0;
    gameOver = false;
    firstMove = true;
    playerPos = {x:0, y:0};

    document.getElementById("stats").innerText = "Kroki: 0";
    document.getElementById("helipad-end").style.visibility = "hidden";

    for(let y=0; y<size; y++) {
        board[y] = [];

        for(let x=0; x<size; x++) {

            board[y][x] = {
                worm:false,
                visited:false
            };

            let cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.x = x;
            cell.dataset.y = y;

            cell.onclick = () => reveal(x,y);

            boardDiv.appendChild(cell);
        }
    }

    placeWorms();
    drawBoard();
}

function placeWorms() {
    let placed = 0;

    while(placed < worms) {

        let x = Math.floor(Math.random()*size);
        let y = Math.floor(Math.random()*size);

        if((x===0 && y===0) || (x===size-1 && y===size-1))
            continue;

        if(!board[y][x].worm) {
            board[y][x].worm = true;
            placed++;
        }
    }
}

function reveal(x, y) {

    if(gameOver) return;

    // --- NOWA LOGIKA: pierwszy krok tylko obok A ---
    if(firstMove) {

        if(!(Math.abs(x-0) + Math.abs(y-0) === 1)) {
            alert("Pierwszy krok musi byÄ‡ o 1 pole od A!");
            return;
        }

        firstMove = false;
    }
    else {
        if(!isAdjacent(x,y)) return;
    }
    // -----------------------------------------------

    const cell = board[y][x];
    const cellDiv = getCell(x,y);

    playerPos = {x,y};
    steps++;
    cell.visited = true;

    updateStats();

    if(cell.worm) {
        cellDiv.classList.add("worm");
        cellDiv.textContent = "ðŸª±";

        gameOver = true;
        revealAllWorms();

        alert("ðŸ’€ PoÅ¼arÅ‚ CiÄ™ Czerw Pustyni!");
        return;
    }

    if(x === size-1 && y === size-1) {
        gameOver = true;

        document.getElementById("helipad-end").style.visibility = "visible";

        alert("ðŸ† DotarÅ‚eÅ› do celu w " + steps + " krokach!");
        return;
    }

    drawBoard();
}

function revealAllWorms() {
    for(let y=0; y<size; y++) {
        for(let x=0; x<size; x++) {
            if(board[y][x].worm) {
                let div = getCell(x,y);
                div.classList.add("worm");
                div.textContent = "ðŸª±";
            }
        }
    }
}

function drawBoard() {

    for(let y=0; y<size; y++) {
        for(let x=0; x<size; x++) {

            const div = getCell(x,y);

            div.className = "cell";
            div.textContent = "";

            if(board[y][x].visited)
                div.classList.add("visited");

            if(x===0 && y===0) {
                div.classList.add("start");
                div.textContent = "A";
            }

            if(x===size-1 && y===size-1) {
                div.classList.add("goal");
                div.textContent = "B";
            }

            if(playerPos.x===x && playerPos.y===y)
                div.textContent = "ðŸ‘£";
        }
    }
}

function getCell(x,y) {
    return document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
}

function updateStats() {
    document.getElementById("stats").innerText =
        `Kroki: ${steps}`;
}

</script>

</body>
</html>
