<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Przeprawa przez Arrakis ‚Äì pe≈Çny klimat</title>

<style>
html, body {
  margin:0;
  padding:0;
  height:100%;
  background: #000;
  color:#e6c47a;
  font-family: "Georgia", serif;
  text-align:center;
  overflow-y: auto;
  position:relative;
}

/* ====== EFEKTY T≈ÅA ====== */
body.shake {
  animation: shake 0.1s infinite;
}

@keyframes shake {
  0% { transform: translate(1px, 1px); }
  25% { transform: translate(-1px, -1px); }
  50% { transform: translate(1px, -1px); }
  75% { transform: translate(-1px, 1px); }
  100% { transform: translate(0,0); }
}

.sand {
  position:fixed;
  width:100%;
  height:100%;
  background:
    repeating-linear-gradient(
      45deg,
      rgba(230,196,122,0.2),
      rgba(230,196,122,0.2) 2px,
      rgba(0,0,0,0) 6px
    );
  animation: drift 60s linear infinite;
  pointer-events:none;
  z-index:1;
}

@keyframes drift {
  from { background-position:0 0; }
  to { background-position:1000px 1000px; }
}

/* ====== G≈Å√ìWNY LAYOUT ====== */

.container {
  position:relative;
  z-index:2;
  padding:20px;
}

/* ----- STEROWANIE W KLIMACIE DIUNY ----- */
#controls {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  margin-bottom:20px;
}

#controls button {
  font-size:1.2em;
  padding:10px 20px;
  background:#111;
  color:#e6c47a;
  border:2px solid #e6c47a;
  border-radius:8px;
  cursor:pointer;
  box-shadow:0 0 10px rgba(230,196,122,0.5);
  transition:all 0.2s;
  width:320px;
}

#controls button:hover {
  background:#222;
  box-shadow:0 0 20px rgba(230,196,122,0.8);
}

#controls label {
  font-size:1em;
  cursor:pointer;
}

/* ----- UK≈ÅAD PLANSZY Z LƒÑDOWISKIEM ----- */
#game-area { display: none; }

#game-area {
  display: none;                 /* domy≈õlnie ukryte */
  /* display: flex */
  justify-content:center;
  align-items:flex-start;
  position:relative;
  gap: 20px;
}
    
/* LƒÖdowisko A ‚Äì statyczne i bli≈ºej planszy */
#helipadA {
  width:120px;
  height:120px;
  background:#333;
  border:3px solid #e6c47a;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  border-radius:10px;

  margin-right:20px;   /* normalny odstƒôp ‚Äì brak nachodzenia */
  margin-top:20px;     /* wyr√≥wnanie z planszƒÖ */
}

/* Plansza */
#board {
  display: inline-grid;
  margin-top: 20px;
  gap: 3px;
  min-height: 50px;
}

/* ----- KOM√ìRKI ----- */

.cell {
  width: 50px;
  height: 50px;
  background: #222;
  border: 2px solid #e6c47a;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-weight: bold;
  font-size: 1.2em;
}

.visited { background: #444; }
.start   { background: darkgreen; }
.goal    { background: darkblue; }
.worm    { background: darkred; color:white; }

input, button {
  background:black;
  color:#e6c47a;
  border:1px solid #e6c47a;
  padding:8px;
  margin:5px;
  cursor:pointer;
}

#audioInfo, #stats {
  margin-top:10px;
  font-size:0.9em;
}
</style>
</head>

<body>

<div class="sand"></div>

<div class="container">
  <h1>Przeprawa przez Arrakis</h1>

  <p>Przejd≈∫ z punktu <b>A</b> do <b>B</b> unikajƒÖc Czerwii Pustyni!</p>

  <div id="controls">
    <button onclick="playNarrator()">üéôÔ∏è Narrator</button>
    <button onclick="showGame(); startGame()">üèúÔ∏è Wyrusz w drogƒô przez piaski</button>
    <label><input type="checkbox" id="hardMode"> Hard Mode ‚Äì ruchome czerwie</label>
  </div>

  <div id="audioInfo">Kliknij gdziekolwiek aby aktywowaƒá sonar üîä</div>
  <div id="stats">Kroki: 0 | Punktacja: 0</div>

  <div id="game-area">
    <div id="helipadA">LƒÖdowisko A</div>
    <div id="board"></div>
  </div>

</div>

<script>
let size = 10;
let worms = 12;

let board = [];
let gameOver = false;
let playerPos = {x:0, y:0};
let steps = 0;
let score = 0;

/* ---- AUDIO ---- */
let audioCtx = null;
let oscillator = null;
let gainNode = null;

function initSound() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  oscillator = audioCtx.createOscillator();
  gainNode = audioCtx.createGain();
  oscillator.type = "sine";
  oscillator.frequency.setValueAtTime(50, audioCtx.currentTime);
  gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  oscillator.start();
}

function updateSoundAndShake() {
  if (!audioCtx) return;

  let minDist = Infinity;

  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      if (board[y][x].worm) {
        let dist = Math.abs(playerPos.x - x) + Math.abs(playerPos.y - y);
        if (dist < minDist) minDist = dist;
      }
    }
  }

  if (minDist === Infinity) minDist = size;

  let freq = 60 + (size - minDist) * 20;
  let volume = Math.max(0, (size - minDist) / size);
  oscillator.frequency.setTargetAtTime(freq, audioCtx.currentTime, 0.1);
  gainNode.gain.setTargetAtTime(volume * 0.35, audioCtx.currentTime, 0.1);

  if (minDist <= 3 && !gameOver)
    document.body.classList.add("shake");
  else
    document.body.classList.remove("shake");
}

function stopSound() {
  if (gainNode)
    gainNode.gain.setTargetAtTime(0, audioCtx.currentTime, 0.2);
}

function showGame() {
  document.getElementById("game-area").style.display = "flex";
}
  
function startGame() {
  const boardDiv = document.getElementById("board");

  board = [];
  gameOver = false;
  playerPos = {x:0, y:0};
  steps = 0;
  score = 0;

  document.getElementById("stats").innerText = `Kroki: 0 | Punktacja: 0`;

  boardDiv.innerHTML = "";
  boardDiv.style.gridTemplateColumns = `repeat(${size}, 50px)`;

  for (let y=0;y<size;y++) {
    board[y]=[];
    for (let x=0;x<size;x++) {
      board[y][x]={worm:false, visited:false};
      const cell = document.createElement("div");
      cell.className="cell";
      cell.dataset.x=x;
      cell.dataset.y=y;
      cell.onclick=()=>moveTo(x,y);
      boardDiv.appendChild(cell);
    }
  }

  placeWorms();
  drawBoard();

  if (!audioCtx) initSound();
}

function placeWorms() {
  let placed=0;
  while(placed<worms) {
    let x=Math.floor(Math.random()*size);
    let y=Math.floor(Math.random()*size);
    if((x===0&&y===0)||(x===size-1&&y===size-1)) continue;
    if(!board[y][x].worm){ board[y][x].worm=true; placed++; }
  }
}

function isAdjacent(x,y){
  return Math.abs(playerPos.x - x) + Math.abs(playerPos.y - y) ===1;
}

function moveTo(x,y){
  if(gameOver) return;
  if(!isAdjacent(x,y)) return;

  playerPos={x,y};
  if(!board[y][x].visited) steps++;
  board[y][x].visited=true;

  updateSoundAndShake();
  document.getElementById("stats").innerText =
    `Kroki: ${steps} | Punktacja: ${score}`;

  if(board[y][x].worm){
    revealWorms();
    stopSound();
    alert("Po≈ºar≈Ç Ciƒô Czerw Pustyni! üíÄ");
    gameOver=true;
    return;
  }

  if(x===size-1 && y===size-1){
    stopSound();
    score = Math.max(0, 100 - steps*2);
    alert(`Dotar≈Çe≈õ do celu! Punkty: ${score}`);
    gameOver=true;
    return;
  }

  drawBoard();
}

function revealWorms() {
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      if(board[y][x].worm){
        const div=getCell(x,y);
        div.classList.add("worm");
        div.textContent="ü™±";
      }
    }
  }
}

function drawBoard(){
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const div=getCell(x,y);
      div.className="cell";
      div.textContent="";

      if(board[y][x].visited) div.classList.add("visited");

      if(x===0 && y===0){
        div.classList.add("start");
        div.textContent="A";
      }

      if(x===size-1 && y===size-1){
        div.classList.add("goal");
        div.textContent="B";
      }

      if(x===playerPos.x && y===playerPos.y)
        div.textContent="üë£";
    }
  }
}

function getCell(x,y){
  return document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
}

function playNarrator(){
  alert("Narrator Diuny: Witaj podr√≥≈ºniku na Arrakis...");
}

document.addEventListener("click", ()=>{
  if(audioCtx && audioCtx.state==="suspended")
    audioCtx.resume();
});

// window.onload=()=>{ startGame(); }; //
</script>

</body>
</html>
