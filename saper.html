<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Skoczek pustynny â€“ Arrakis</title>

<style>
html, body {
    margin:0; padding:0; height:100%;
    background:#000; color:#e6c47a;
    font-family:"Georgia",serif;
    text-align:center;
    display:flex;
    justify-content:center;
    align-items:center;
}

.container {
    width:90%;
    max-width:900px;
}

body.shake {animation: shake 0.1s infinite;}
@keyframes shake {
    0% {transform:translate(1px,1px);}
    25% {transform:translate(-1px,-1px);}
    50% {transform:translate(1px,-1px);}
    75% {transform:translate(-1px,1px);}
    100% {transform:translate(0,0);}
}

#board-wrapper {
    display:flex;
    justify-content:center;
    align-items:center;
    gap:20px;
    margin-top:20px;
    visibility:hidden;
    position:relative;
}

#board {
    display:inline-grid;
    gap:3px;
}

.cell {
    width:50px;
    height:50px;
    background:#222;
    border:2px solid #e6c47a;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    font-weight:bold;
    font-size:1.2em;
}

.visited {background:#444;}
.start {background:darkgreen; color:white;}
.goal {background:darkblue; color:white;}
.worm {background:darkred; color:white;}

#helipad, #helipad-end {
    width:70px;
    height:70px;
    background:#333;
    border:2px solid #e6c47a;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:bold;
    border-radius:8px;
}

#helipad-end {
    position:absolute;
    display:none;
}

.popup {
    position:fixed;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    background:#111;
    color:#e6c47a;
    border:3px solid #e6c47a;
    padding:20px;
    display:none;
}
</style>
</head>

<body>

<div class="container">
<h1>Przeprawa przez Arrakis</h1>

<button onclick="startGame()">Nowa gra</button>

<div id="stats">Kroki: 0</div>

<div id="board-wrapper">
    <div id="helipad">A</div>
    <div id="board"></div>
</div>

<div id="helipad-end">B</div>

<div id="popup" class="popup"></div>

</div>

<script>

const size = 10;
const worms = 12;

let board = [];
let gameOver = false;
let playerPos = {x:0, y:0};
let steps = 0;
let firstMove = true;

function startGame() {

    const boardDiv = document.getElementById("board");

    document.getElementById("board-wrapper").style.visibility = "visible";
    document.getElementById("helipad-end").style.display = "none";

    boardDiv.innerHTML = "";
    boardDiv.style.gridTemplateColumns = `repeat(${size},50px)`;

    board = [];
    gameOver = false;
    steps = 0;
    playerPos = {x:0,y:0};
    firstMove = true;

    document.getElementById("stats").innerText = "Kroki: 0";

    for(let y=0; y<size; y++) {
        board[y] = [];
        for(let x=0; x<size; x++) {

            board[y][x] = {
                worm:false,
                visited:false
            };

            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.x = x;
            cell.dataset.y = y;

            cell.onclick = () => moveTo(x,y);

            boardDiv.appendChild(cell);
        }
    }

    placeWorms();
    drawBoard();
}

function placeWorms() {

    let placed = 0;

    while(placed < worms) {
        let x = Math.floor(Math.random()*size);
        let y = Math.floor(Math.random()*size);

        if((x===0 && y===0) || (x===size-1 && y===size-1))
            continue;

        if(!board[y][x].worm) {
            board[y][x].worm = true;
            placed++;
        }
    }
}

function isAdjacent(x,y) {

    const dx = Math.abs(playerPos.x - x);
    const dy = Math.abs(playerPos.y - y);

    return (dx + dy === 1);
}

function moveTo(x,y) {

    if(gameOver) return;

    // --- BLOKADA PIERWSZEGO RUCHU ---
    if(firstMove) {
        if(!isAdjacent(x,y))
            return;
        firstMove = false;
    }

    // --- RUCH TYLKO O 1 POLE ---
    if(!isAdjacent(x,y))
        return;

    playerPos = {x,y};
    steps++;

    const cell = board[y][x];
    cell.visited = true;

    document.getElementById("stats").innerText = `Kroki: ${steps}`;

    if(cell.worm) {
        gameOver = true;
        revealAllWorms();
        showPopup("ðŸ’€ PoÅ¼arÅ‚ CiÄ™ Czerw!");
        return;
    }

    // WYGRANA
    if(x === size-1 && y === size-1) {
        gameOver = true;
        revealAllWorms();
        showPopup("ðŸ† DotarÅ‚eÅ› do celu!");

        showHelipadB();
    }

    drawBoard();
}

function showHelipadB() {

    const boardDiv = document.getElementById("board");
    const rect = boardDiv.getBoundingClientRect();

    const helipad = document.getElementById("helipad-end");

    helipad.style.display = "flex";

    helipad.style.left = (rect.right + 10) + "px";
    helipad.style.top = (rect.bottom - 70) + "px";
}

function revealAllWorms() {
    for(let y=0;y<size;y++)
        for(let x=0;x<size;x++)
            if(board[y][x].worm) {
                const div = getCell(x,y);
                div.classList.add("worm");
                div.textContent = "ðŸª±";
            }
}

function drawBoard() {

    for(let y=0;y<size;y++) {
        for(let x=0;x<size;x++) {

            const div = getCell(x,y);

            div.className = "cell";
            div.textContent = "";

            if(board[y][x].visited)
                div.classList.add("visited");

            if(x===0 && y===0) {
                div.classList.add("start");
                div.textContent = "A";
            }

            if(x===size-1 && y===size-1) {
                div.classList.add("goal");
                div.textContent = "B";
            }

            if(playerPos.x===x && playerPos.y===y)
                div.textContent = "ðŸ‘£";
        }
    }
}

function getCell(x,y) {
    return document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
}

function showPopup(text) {
    const p = document.getElementById("popup");
    p.innerText = text;
    p.style.display = "block";
}

</script>
</body>
</html>
