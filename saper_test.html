<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Przeprawa przez Arrakis ‚Äì pe≈Çny klimat</title>
<style>
html, body {
  margin:0;
  padding:0;
  height:100%;
  background:#000;
  color:#e6c47a;
  font-family:"Georgia", serif;
  overflow-x:hidden;
}

/* ===== T≈ÅO ===== */
body.shake {
  animation: shake 0.1s infinite;
}
@keyframes shake {
  0% { transform: translate(1px,1px); }
  25% { transform: translate(-1px,-1px); }
  50% { transform: translate(1px,-1px); }
  75% { transform: translate(-1px,1px); }
  100% { transform: translate(0,0); }
}
.sand {
  position:fixed;
  width:100%;
  height:100%;
  background: repeating-linear-gradient(45deg, rgba(230,196,122,0.2), rgba(230,196,122,0.2) 2px, rgba(0,0,0,0) 6px);
  animation: drift 60s linear infinite;
  pointer-events:none;
  z-index:1;
}

/* ===== KONTAINER ===== */
.container {
  position:relative;
  z-index:2;
  width:100%;
  text-align:center;
  padding-top:20px;
}

/* ===== STEROWANIE ===== */
#controls {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  margin-bottom:10px;
}
#controls button {
  font-size:1.2em;
  padding:10px 20px;
  background:#111;
  color:#e6c47a;
  border:2px solid #e6c47a;
  border-radius:8px;
  cursor:pointer;
  box-shadow:0 0 10px rgba(230,196,122,0.5);
  width:320px;
}
#controls button:hover {
  background:#222; box-shadow:0 0 20px rgba(230,196,122,0.8);
}
#controls label { font-size:1em; cursor:pointer; }

#audioInfo, #stats { margin-top:10px; font-size:0.9em; }

/* ===== GAME AREA ===== */
#game-area {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  margin: 15px auto 0 auto;
  gap: 20px;

  visibility: hidden;   /* üîë */
}

/* LƒÖdowiska jako przyciski z ramkƒÖ */
#helipadA, #helipadB {
  width:120px; height:120px;
  border:2px solid #e6c47a;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  border-radius:10px;
  cursor:pointer;
  flex-shrink:0;
}

/* A wyjustowane do g√≥ry planszy */
#helipadA { flex-shrink: 0;}

/* B wyjustowane do do≈Çu planszy, domy≈õlnie ukryte */
#helipadB { flex-shrink: 0; }

/* ===== PLANSZA ===== */
#board-wrapper {
  display:flex;
  flex-direction:column;
  align-items:center;
}

#board {
  display:inline-grid;
  gap:3px;
}

#worm-map {
  margin-top:15px;
  display:inline-grid;
  gap:2px;
}

/* ===== KOM√ìRKI ===== */
.cell {
  width:50px; height:50px;
  background:#222;
  border:2px solid #e6c47a;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-weight:bold;
  font-size:1.2em;
}

#worm-map .cell { width:20px; height:20px; font-size:0.8em; }

.visited { background:#444; }
.start { background:darkgreen; }
.goal { background:darkblue; }
.worm { background:darkred; color:white; }

</style>
</head>
<body>
<div class="sand"></div>

<div class="container">
  <h1>Przeprawa przez Arrakis</h1>
  <p>Przejd≈∫ z punktu <b>A</b> do <b>B</b> unikajƒÖc Czerwii Pustyni!</p>

  <div id="controls">
    <button onclick="playNarrator()">üéôÔ∏è Narrator</button>
    <button onclick="showGame(); startGame()">üèúÔ∏è Wyrusz w drogƒô przez piaski</button>
    <label><input type="checkbox" id="hardMode"> Hard Mode ‚Äì ruchome czerwie</label>
  </div>

  <div id="audioInfo">Kliknij gdziekolwiek aby aktywowaƒá sonar üîä</div>
  <div id="stats">Kroki: 0 | Punktacja: 0</div>

<div id="game-area">
  <div id="board-wrapper">
    <div id="board"></div>
    <div id="worm-map"></div>
  </div>
  <div id="helipadA">LƒÖdowisko A</div>
  <div id="helipadB">LƒÖdowisko B</div>
</div>

<script>
let size=10, worms=12, board=[], gameOver=false, playerPos={x:0,y:0}, steps=0, score=0;
let audioCtx=null, oscillator=null, gainNode=null;

function initSound(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  oscillator=audioCtx.createOscillator();
  gainNode=audioCtx.createGain();
  oscillator.type="sine";
  oscillator.frequency.setValueAtTime(50,audioCtx.currentTime);
  gainNode.gain.setValueAtTime(0,audioCtx.currentTime);
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  oscillator.start();
}

function updateSoundAndShake(){
  if(!audioCtx) return;
  let minDist=Infinity;
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      if(board[y][x].worm){
        let dist=Math.abs(playerPos.x-x)+Math.abs(playerPos.y-y);
        if(dist<minDist) minDist=dist;
      }
    }
  }
  if(minDist===Infinity) minDist=size;
  oscillator.frequency.setTargetAtTime(60+(size-minDist)*20,audioCtx.currentTime,0.1);
  gainNode.gain.setTargetAtTime(Math.max(0,(size-minDist)/size)*0.35,audioCtx.currentTime,0.1);
  if(minDist<=3 && !gameOver) document.body.classList.add("shake");
  else document.body.classList.remove("shake");
}

function stopSound(){ if(gainNode) gainNode.gain.setTargetAtTime(0,audioCtx.currentTime,0.2); }

function showGame(){
  document.getElementById("game-area").style.visibility = "visible";
}

function startGame(){
  const boardDiv=document.getElementById("board");
  const wormDiv=document.getElementById("worm-map");
  board=[]; gameOver=false; playerPos={x:0,y:0}; steps=0; score=0;
  document.getElementById("stats").innerText=`Kroki: 0 | Punktacja: 0`;
  boardDiv.innerHTML=""; wormDiv.innerHTML="";
  boardDiv.style.gridTemplateColumns=`repeat(${size},50px)`;
  wormDiv.style.gridTemplateColumns=`repeat(${size},20px)`;
  for(let y=0;y<size;y++){
    board[y]=[];
    for(let x=0;x<size;x++){
      board[y][x]={worm:false,visited:false};
      const cell=document.createElement("div");
      cell.className="cell"; cell.dataset.x=x; cell.dataset.y=y;
      cell.onclick=()=>moveTo(x,y);
      boardDiv.appendChild(cell);
      const wcell=document.createElement("div");
      wcell.className="cell"; wcell.dataset.x=x; wcell.dataset.y=y;
      wormDiv.appendChild(wcell);
    }
  }
  placeWorms(); drawBoard(); updateWormMap();
  if(!audioCtx) initSound();
}

function placeWorms(){
  let placed=0;
  while(placed<worms){
    let x=Math.floor(Math.random()*size);
    let y=Math.floor(Math.random()*size);
    if((x===0&&y===0)||(x===size-1&&y===size-1)) continue;
    if(!board[y][x].worm){ board[y][x].worm=true; placed++; }
  }
}

function isAdjacent(x,y){ return Math.abs(playerPos.x-x)+Math.abs(playerPos.y-y)===1; }

function moveTo(x,y){
  if(gameOver) return;
  if(!isAdjacent(x,y)) return;
  playerPos={x,y};
  if(!board[y][x].visited) steps++;
  board[y][x].visited=true;
  updateSoundAndShake();
  document.getElementById("stats").innerText=`Kroki: ${steps} | Punktacja: ${score}`;
  if(board[y][x].worm){ revealWorms(); stopSound(); alert("Po≈ºar≈Ç Ciƒô Czerw Pustyni! üíÄ"); gameOver=true; return; }
  if(x===size-1 && y===size-1){
    stopSound(); score=Math.max(0,100-steps*2);
    alert(`Dotar≈Çe≈õ do celu! Punkty: ${score}`);
    gameOver=true;
    document.getElementById("helipadB").style.display="flex"; // poka≈º B
    return;
  }
  drawBoard();
}

function revealWorms(){ 
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      if(board[y][x].worm){
        const div=getCell(x,y); div.classList.add("worm"); div.textContent="ü™±";
      }
    }
  }
}

function drawBoard(){
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const div=getCell(x,y); div.className="cell"; div.textContent="";
      if(board[y][x].visited) div.classList.add("visited");
      if(x===0 && y===0){ div.classList.add("start"); div.textContent="A"; }
      if(x===size-1 && y===size-1){ div.classList.add("goal"); div.textContent="B"; }
      if(x===playerPos.x && y===playerPos.y) div.textContent="üë£";
    }
  }
}

function getCell(x,y){ return document.querySelector(`.cell[data-x='${x}'][data-y='${y}']`); }

function updateWormMap(){
  const wormDiv=document.getElementById("worm-map");
  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      const div=wormDiv.querySelector(`.cell[data-x='${x}'][data-y='${y}']`);
      div.textContent=board[y][x].worm ? "ü™±" : "";
    }
  }
}

function playNarrator(){ alert("Narrator Diuny: Witaj podr√≥≈ºniku na Arrakis..."); }

document.addEventListener("click",()=>{ if(audioCtx && audioCtx.state==="suspended") audioCtx.resume(); });
</script>
</body>
</html>
